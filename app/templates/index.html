<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-cloud-sun"></i> WeatherNow
            </div>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-menu">
                <li><a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="{{ url_for('impressum') }}"><i class="fas fa-info-circle"></i> Impressum</a></li>
                <li><a href="{{ url_for('datenschutz') }}"><i class="fas fa-shield-alt"></i> Datenschutz</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <h1>Weather Dashboard</h1>
            <p class="location">
                <i class="fas fa-map-marker-alt"></i> {{ location_name }}
            </p>
            <p class="last-updated">
                <i class="fas fa-clock"></i> Last updated: {{ weather.current.time }}
            </p>
        </div>

        <!-- Current Weather -->
        <div class="current-weather glass-card">
            <div class="weather-main-card">
                <div class="weather-header">
                    <div class="temp-display">
                        <img src="http://openweathermap.org/img/wn/{{ weather.current.icon }}@2x.png" alt="{{ weather.current.weather }}" class="weather-icon-large">
                        <div class="temp-info">
                            <div class="main-temp">{{ weather.current.temp }}°</div>
                            <div class="feels-like">Feels like {{ weather.current.feels_like }}°C</div>
                            <div class="condition">{{ weather.current.weather }}</div>
                        </div>
                    </div>
                </div>

                <!-- Weather Stats -->
                <div class="weather-stats">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <span class="stat-label">Humidity</span>
                        </div>
                        <div class="stat-value">{{ weather.current.humidity }}%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-wind"></i>
                            </div>
                            <span class="stat-label">Wind Speed</span>
                        </div>
                        <div class="stat-value">{{ weather.current.wind_speed }} m/s</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-compress-arrows-alt"></i>
                            </div>
                            <span class="stat-label">Pressure</span>
                        </div>
                        <div class="stat-value">{{ weather.current.pressure }} hPa</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <span class="stat-label">UV Index</span>
                        </div>
                        <div class="stat-value">{{ weather.current.uvi }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hourly Forecast -->
        <div class="forecast-section">
            <div class="section-header">
                <i class="fas fa-clock"></i>
                <h2>36-Hour Forecast</h2>
            </div>

            <div class="forecast-container-wrapper">
                <button class="scroll-btn left" onclick="scrollForecast(-300)">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <div class="forecast-scroll" id="forecastScroll">
                    <!-- Hour Cards -->
                    {% for hour in weather.hourly %}
                    <div class="hour-card">
                        <div class="hour-time">{{ hour.time }}</div>
                        <img src="http://openweathermap.org/img/wn/{{ hour.icon }}.png" alt="{{ hour.weather }}" class="hour-icon">
                        <div class="hour-temp">{{ hour.temp }}°</div>
                        <div class="hour-details">
                            <div class="hour-detail">
                                <i class="fas fa-tint"></i> {{ hour.humidity }}%
                            </div>
                            <div class="hour-detail">
                                <i class="fas fa-wind"></i> {{ hour.wind_speed }} m/s
                            </div>
                            {% if hour['pop'] > 0 %}
                            <div class="hour-detail">
                                <i class="fas fa-umbrella"></i> {{ hour['pop'] }}%
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <button class="scroll-btn right" onclick="scrollForecast(300)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Weather Widgets -->
        <div class="widgets-section">
            <div class="widgets-grid">
                <div class="widget-card">
                    <h2>
                        <i class="fas fa-radar" style="color: var(--primary);"></i>
                        Live Weather Radar
                    </h2>
                    <iframe 
                        src="https://www.rainviewer.com/map.html?loc=49.939,11.560,7&oAP=1&c=5&o=50&layer=sat-rad&sm=1&sn=1&ts=1&marker=49.939,11.560,red-pushpin" 
                        width="100%" 
                        height="400" 
                        frameborder="0" 
                        style="border:0;border-radius:16px;" 
                        allowfullscreen
                        title="Live Weather Radar">
                    </iframe>
                </div>

                <div class="widget-card">
                    <h2>
                        <i class="fas fa-video" style="color: var(--secondary);"></i>
                        Live Webcam
                    </h2>
                    <div class="webcam-embed">
                        <a 
                            name="windy-webcam-timelapse-player" 
                            data-id="1190793231" 
                            data-play="day" 
                            data-loop="0" 
                            data-auto-play="0"
                            data-force-full-screen-on-overlay-play="0"
                            data-interactive="1" 
                            href="https://windy.com/webcams/1190793231"
                            target="_blank"
                            style="color: var(--text-primary);">
                            Webcam in der Bayreuther Fußgängerzone
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://webcams.windy.com/webcams/public/embed/v2/script/player.js"></script>
    <script>
        function scrollForecast(amount) {
            const container = document.getElementById('forecastScroll');
            container.scrollBy({
                left: amount,
                behavior: 'smooth'
            });
        }

        // Touch drag support
        const container = document.getElementById('forecastScroll');
        let isDown = false;
        let startX;
        let scrollLeft;

        container.addEventListener('mousedown', (e) => {
            isDown = true;
            startX = e.pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
            container.style.cursor = 'grabbing';
        });

        container.addEventListener('mouseleave', () => {
            isDown = false;
            container.style.cursor = 'grab';
        });

        container.addEventListener('mouseup', () => {
            isDown = false;
            container.style.cursor = 'grab';
        });

        container.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - container.offsetLeft;
            const walk = (x - startX) * 2;
            container.scrollLeft = scrollLeft - walk;
        });

        // Touch support
        container.addEventListener('touchstart', (e) => {
            isDown = true;
            startX = e.touches[0].pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
        });

        container.addEventListener('touchend', () => {
            isDown = false;
        });

        container.addEventListener('touchmove', (e) => {
            if (!isDown) return;
            const x = e.touches[0].pageX - container.offsetLeft;
            const walk = (x - startX) * 2;
            container.scrollLeft = scrollLeft - walk;
        });
    </script>
</body>
</html>