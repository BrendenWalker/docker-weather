<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <nav class="menu">
        <button class="menu-button"><i class="fas fa-bars"></i> Menu</button>
        <ul class="menu-list">
            <li><a href="{{ url_for('index') }}">Home</a></li>
            <li><a href="{{ url_for('impressum') }}">Impressum</a></li>
            <li><a href="{{ url_for('datenschutz') }}">Datenschutz</a></li>
        </ul>
    </nav>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cloud-sun"></i> Weather Dashboard</h1>
            <div class="location-info">
                <h2>{{ location_name }}</h2>
                <div class="last-updated">Last updated: {{ weather.current.time }}</div>
            </div>
        </header>
        
        <div class="current-weather">
            <div class="weather-card">
                <div class="weather-main">
                    <div class="weather-icon">
                        <img src="http://openweathermap.org/img/wn/{{ weather.current.icon }}@2x.png" alt="{{ weather.current.weather }}">
                    </div>
                    <div class="temp">{{ weather.current.temp }}°C</div>
                </div>
                <div class="weather-details">
                    <div><span>Condition:</span> {{ weather.current.weather }}</div>
                    <div><span>Humidity:</span> {{ weather.current.humidity }}%</div>
                    <div><span>UV Index:</span> {{ weather.current.uvi }}</div>
                    <div><span>Wind Speed:</span> {{ weather.current.wind_speed }} m/s</div>
                    <div><span>Feels Like:</span> {{ weather.current.feels_like }}°C</div>
                    <div><span>Pressure:</span> {{ weather.current.pressure }} hPa</div>
                </div>
            </div>
        </div>
        
        <div class="hourly-forecast">
            <h2><i class="fas fa-clock"></i> 36-Hour Forecast</h2>
            <div class="forecast-scroller">
                <button class="scroll-button left" onclick="scrollForecast(-300)" aria-label="Scroll left">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="forecast-container" id="forecastContainer">
                    {% for hour in weather.hourly %}
                    <div class="hour-card">
                        <div class="hour-time">{{ hour.time }}</div>
                        <img src="http://openweathermap.org/img/wn/{{ hour.icon }}.png" alt="{{ hour.weather }}">
                        <div class="hour-temp">{{ hour.temp }}°C</div>
                        <div class="hour-details">
                            <div><i class="fas fa-tint"></i> {{ hour.humidity }}%</div>
                            <div><i class="fas fa-wind"></i> {{ hour.wind_speed }} m/s</div>
                            <div><i class="fas fa-umbrella"></i> {% if hour['pop'] > 0 %}{{ hour['pop'] }}%{% endif %}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button class="scroll-button right" onclick="scrollForecast(300)" aria-label="Scroll right">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="weather-widgets">
        <div id="radar-container">
            <h2><i class="fas fa-radar"></i> Live Weather Radar</h2>
            <iframe 
                src="https://www.rainviewer.com/map.html?loc=49.939,11.560,7&oAP=1&c=5&o=50&layer=sat-rad&sm=1&sn=1&ts=1&marker=49.939,11.560,red-pushpin" 
                width="100%" 
                frameborder="0" 
                style="border:0;height:50vh;" 
                allowfullscreen
                title="Live Weather Radar">
            </iframe>
        </div>

        <div id="webcam-container">
            <h2><i class="fas fa-video"></i> Live Webcam</h2>
            <a 
                name="windy-webcam-timelapse-player" 
                data-id="1190793231" 
                data-play="day" 
                data-loop="0" 
                data-auto-play="0"
                data-force-full-screen-on-overlay-play="0"
                data-interactive="1" href="https://windy.com/webcams/1190793231"
                target="_blank">City: Webcam in der Bayreuther Fußgängerzone
            </a>
            <script 
                async type="text/javascript"
                src="https://webcams.windy.com/webcams/public/embed/v2/script/player.js"
            ></script>
        </div>
    </div>

    <script>
        // Horizontal scrolling function
        function scrollForecast(scrollAmount) {
            const container = document.getElementById('forecastContainer');
            container.scrollBy({
                left: scrollAmount,
                behavior: 'smooth'
            });
        }

        // Touch and drag support
        const container = document.getElementById('forecastContainer');
        let isDown = false;
        let startX;
        let scrollLeft;

        container.addEventListener('mousedown', (e) => {
            isDown = true;
            startX = e.pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
            container.style.cursor = 'grabbing';
        });

        container.addEventListener('mouseleave', () => {
            isDown = false;
            container.style.cursor = 'grab';
        });

        container.addEventListener('mouseup', () => {
            isDown = false;
            container.style.cursor = 'grab';
        });

        container.addEventListener('mousemove', (e) => {
            if(!isDown) return;
            e.preventDefault();
            const x = e.pageX - container.offsetLeft;
            const walk = (x - startX) * 2;
            container.scrollLeft = scrollLeft - walk;
        });

        // Touch support
        container.addEventListener('touchstart', (e) => {
            isDown = true;
            startX = e.touches[0].pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
        });

        container.addEventListener('touchend', () => {
            isDown = false;
        });

        container.addEventListener('touchmove', (e) => {
            if(!isDown) return;
            e.preventDefault();
            const x = e.touches[0].pageX - container.offsetLeft;
            const walk = (x - startX) * 2;
            container.scrollLeft = scrollLeft - walk;
        });
    </script>
</body>
</html>